# Project: Pixnet Blog Migration to Astro

## Project Overview
This project is a static blog migrated from Pixnet to Astro. It uses a "Magazine" style layout with TailwindCSS.

## 隨時使用中文回報/溝通

## Core Workflows

### 1. Content Management & Scraping
- **Scraping**: Use `scrape_pixnet.js` to fetch articles from `pixnet_articles_db.json`.
- **Images**:
  - **Flickr**: Do NOT download. Hotlink directly to save space (logic implemented in `repair_images.js`).
  - **Pixnet**: Download locally to `public/images/posts/` to prevent link rot.
  - **Repair**: Run `node repair_images.js` to fix broken links or missing images.
- **Dates**: Run `node fix_dates.js` to ensure frontmatter `date` matches the original Pixnet publish date.

### 2. Business Status Verification
- **Report**: Maintain `business_status.md` for checking shop statuses.
- **Automation**: Run `node mark_closed_businesses.js`. This script reads `business_status.md` (identifying "已歇業" status) and automatically injects a "Closed Shop" warning banner into the markdown of articles mentioning closed businesses.

### 3. Deployment (GitHub Pages)
- **Method**: GitHub Actions (`.github/workflows/deploy.yml`).
- **Configuration**: Must set `site` and `base` in `astro.config.mjs` correctly.
  - `site`: `https://<username>.github.io`
  - `base`: `/<repo-name>`
- **Common Issues**:
  - **404 Error**: Ensure GitHub Pages "Source" is set to "GitHub Actions" in Settings.
  - **Push Failure (500/Timeout)**: Check for large untracked files (e.g., `gen_ai_*`, `node_modules`) that might have been accidentally staged. Use `git push -f` if history gets bloated with garbage objects.

## Technical Stack
- **Framework**: Astro 5.x
- **Styling**: TailwindCSS + @tailwindcss/typography
- **Scripts**: Node.js (Axios, Cheerio)
- **Content**: Markdown/MDX with Frontmatter

## Rules for AI Agents
- **Aesthetics**: Maintain the "Magazine" style. Use high-quality images and responsive grids.
- **Business Logic**: Always verify business status before answering "where to eat" queries based on this content.
- **Image Strategy**: Prioritize external linking for Flickr; download only when necessary (Pixnet/other).

### Terminal Command Execution
- **NEVER chain commands** using `;` or `&&` (e.g., `git add . ; git commit`).
- ALWAYS execute commands sequentially in separate steps.
- **CRITICAL: FORBIDDEN CHARACTERS (Security Trigger)**
  - **These characters trigger manual permission prompts EVEN IF `SafeToAutoRun` is true.**
  - **NEVER** use them in ANY command argument (especially `git commit` messages):
    - `(` or `)` (Parentheses) -> ❌ `Fix (CSP)` ✅ `Fix CSP`
    - **Conventional Commits Warning**:
      - ❌ `fix(crawler):` -> Triggers Prompt (Parentheses)
      - ✅ `fix: crawler -` -> Safe (No Parentheses)
    - `&` (Ampersand) -> ❌ `UI & API` ✅ `UI and API`
    - `|` (Pipe) -> Remove
    - `;` (Semicolon) -> Remove
    - `$` (Dollar Sign) -> Remove
  - **Reason**: PowerShell treats these as executable blocks/operators. The IDE's security layer intercepts them before the agent's "Safe" flag can apply.
  
  - **Reason**: PowerShell treats these as executable blocks/operators. The IDE's security layer intercepts them before the agent's "Safe" flag can apply.
  
  - ❌ `git commit -m "fix(crawler): update Momo AI info (v0.0.87)"` -> **Triggers Prompt (parentheses)!**
  - ✅ `git commit -m "fix: crawler - update Momo AI info - v0.0.87"` -> **Auto-runs**

  - **Avoid `curl` with complex URLs**:
    - URLs with `?` or `&` often trigger paranoid shell checks even when quoted.
    - ❌ `curl -I "https://example.com?foo=bar&baz=1"`
    - ✅ Use `read_url_content` tool OR `node -e` scripts instead.

- **GLOBAL INSTALL REQUIRES PERMISSION** (設計如此):
  - `npm install -g` 會修改系統全域狀態，因此**永遠需要權限確認**。
  - 這是安全機制，不是 Bug。即使 `npm` 在 Allow List 中也一樣。
  - ❌ 無法自動執行: `npm install -g @railway/cli`
  - ✅ 可以自動執行: `npm install express` (專案內安裝)

- ** 文章歸類(網頁右邊分類區)
  - 同步文章來源的"文章標籤(語言要一致)"並顯示"文章標籤"在頂部 (flex flex-wrap items-center gap-3 text-sm text-gray-500 mb-4)
  - 同步文章來源的"個人分類"並顯示"個人分類"(超連結)在文末，點擊可以連到同一個分類區
  - 右邊分類區需要包含所有的"個人分類"項目
  - 文章根據"個人分類"來自動分類到右邊分類區
  ![alt text](image.png)
  - 新增新的文章要可以根據"個人分類"自動分類
  - 所有文章都應該要進行分類，如果找不到個人分類，請歸類為其他
  - Regresion test: 隨機挑5篇文章，驗證文章標籤、文章應出現在合適的分類區

- ** 文章動態營業狀態lable顯示
  - 要根據"目前時間"比對"文章內的營業時間(如果有)"用動態顯示營業狀態
    - 營業狀態: 已歇業、營業中、休息中(距離幾小時後開門 or 今日未營業)
    - 要使用lable標籤來顯示
  - Regresion test: 隨機挑5篇文章，根據目前裝置時間，驗證文章是否顯示正確的營業狀態

- ** 文章的創建時間要與原文章一致
  - Regresion test: 隨機挑5篇文章，驗證文章的創建時間是否與原文章一致

- ** 確保文章的標題要與原文章一致
  - Regresion test: 隨機挑15篇不同地區文章，驗證文章的標題是否與原文章一致

- ** 確保網頁所有的按鈕都要能運作
  - Regresion test: 隨機挑10個非重複功能的按鈕，驗證按鈕是否能運作，且與按鈕目標一致

- ** 確保網頁所有的超連結都要能運作
  - Regresion test: 隨機挑10個非重複超連結，驗證超連結是否能運作，且與超連結目標一致

- ** 確保網頁所有的圖片都要能運作
  - Regresion test: 隨機挑10個非重複圖片，驗證圖片是否能運作，且與圖片目標一致