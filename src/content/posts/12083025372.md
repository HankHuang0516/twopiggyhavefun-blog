---
title: '*教學*Arduino WIFI(ESP8266) Time同步設計'
date: '2015-08-12T07:22:15.000Z'
cover: 'https://pimg.1px.tw/lolwarden/1439367649-894964179.png'
tags:
  - pixnet
  - unread
originalUrl: 'https://lolwarden.pixnet.net/blog/posts/12083025372'
businessHours: null
isPermanentlyClosed: false
category: 教學
---

<div class="pixnet-article prose max-w-none">
<p><span style="font-size: 10pt;">之前初次上手應用所寫的程式碼是用到Arduino內建Delay函數</span></p><p><span style="font-size: 10pt;">本次實驗是不用內建Delay函數。</span></p><p>&nbsp;</p><p><span style="font-size: 10pt;">以前學習Verilog的習慣是利用V-code時脈同步特性去設計韌體</span></p><p><span style="font-size: 13.3333330154419px;">Arduino說穿了，用的就是C的語法</span></p><p><span style="font-size: 10pt;">但V-code與一般軟體的語法非常不一樣</span></p><p><span style="font-size: 10pt;">兩種比起來我覺得同步時脈可以應用在此，甚至可以發揮得更好!</span></p><p>&nbsp;</p><p>如果一個Aduino系統寫得越龐大，相對的各個模組的延遲時間(Delay)會互相影響，導致系統容易產生崩潰當機。</p><p>解決此問題的方法，就是利用同步時脈的概念，把每個模組的Delay給取代成固定頻率去執行。</p><p>&nbsp;</p><p>但是Arduino loop() 頻率是板子上石英震盪器的頻率，有8M也有16M等等，如果要設定成固定頻率就必須用到 <a href="https://github.com/JChristensen/Timer#installation">"Timer函式"(點擊下載)</a></p><p>下載好放在Arduino library裡</p><p>&nbsp;</p><p style="text-align: center;"><strong style="font-size: 16px;">實驗方法</strong></p><p style="text-align: center;"><span style="font-size: 10pt;">1.設計流程圖</span></p><p style="text-align: center;"><span style="font-size: 10pt;">2.Code除頻器</span></p><p style="text-align: center;"><span style="font-size: 10pt;">3.規劃狀態</span></p><p style="text-align: center;"><span style="font-size: 10pt;">4.完成</span></p><p style="text-align: center;"><span style="font-size: 12pt;"><strong>&nbsp;<a href="http://lolwarden.pixnet.net/blog/post/83024121"><span style="text-align: center;">請配合Code一起服用</span></a></strong></span></p><p style="text-align: center;"><span style="font-size: 12pt;"><strong>實驗開始</strong></span></p><p>一.<span style="font-size: 13.3333330154419px;">設計流程圖</span></p><p>1. <a href="http://lolwarden.pixnet.net/blog/post/82061583">打開舊版Code</a></p><p>2.可以知道WIFI作傳輸總共有4個步驟: (1.)初始化，測試WIFI模組是否正常。(2.)WIFI模組基本功能設定。(3.)上傳數值至雲端。(4.)錯誤待滯區</p><p>3.設計出流程圖</p><p><a href="http://lolwarden.pixnet.net/album/photo/5824621"><img style="display: block; margin-left: auto; margin-right: auto;" title="WIFI_Module_flowsheet.png" src="https://pimg.1px.tw/lolwarden/1439367649-894964179.png" alt="WIFI_Module_flowsheet.png" border="0"></a></p><p>&nbsp;<span style="font-size: 13.3333330154419px;">二.Code除頻器</span></p><p>&nbsp;1.在這邊 t.every()的單位時間是1m sec ，所以t.every(100,Wifi_main)就是0.1 sec 執行一次&nbsp;Wifi_main 的函式。</p><pre style="font-family: 'Andale Mono', 'Lucida Console', Monaco, fixed, monospace; border: 1px dashed #999999; line-height: 14px; padding: 5px; overflow: auto; width: 1331px; background-color: #eeeeee;"><code>t.every(100, Wifi_main);</code></pre><p>2. 所以delaytime 的單位時間在Wifi_main 的函式裡就是 0.1 秒 ， 原地數10次就等於1秒。</p><pre style="font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; color: #000000; background-color: #eee; font-size: 12px; border: 1px dashed #999999; line-height: 14px; padding: 5px; overflow: auto; width: 100%;"><code>if (delaytime==10){ //delay 1 sec  delaytime=0;  if(debug.find("OK")){    Wifi_State=1; //next setting wifi mode  }  else{     Wifi_State=0; //back  }}else{delaytime++;}</code></pre><p>&nbsp;</p><p><span style="font-size: 13.3333330154419px;">三.規劃狀態</span></p><p><span style="font-size: 13.3333330154419px;">1.在這裡就直接圖解了。每個狀態都有自己不同的工作，而切換狀態的頻率就是&nbsp;t.every()的時間倒數。</span></p><p><span style="font-size: 13.3333330154419px;"><a href="http://lolwarden.pixnet.net/album/photo/5826013"><img style="display: block; margin-left: auto; margin-right: auto;" title="WIFI_Module_flowsheet_State.png" src="https://pimg.1px.tw/lolwarden/1439368513-2395380394.png" alt="WIFI_Module_flowsheet_State.png" border="0"></a></span></p><p>&nbsp;</p><p><span style="font-size: 13.3333330154419px; text-align: center;">四.完成</span></p><p>


</p>
</div>
