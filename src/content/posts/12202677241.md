---
title: '*情人節DIY*製作情侶專屬音樂盒_程式碼'
date: '2016-05-21T10:20:07.000Z'
cover: 'https://pimg.1px.tw/blog/lolwarden/logo/841522413162664851.webp'
tags:
  - pixnet
  - unread
originalUrl: 'https://lolwarden.pixnet.net/blog/posts/12202677241'
businessHours: null
isPermanentlyClosed: false
category: Code
---

<div class="pixnet-article prose max-w-none">
<p>&nbsp;<span style="color: #777777; font-family: arial; letter-spacing: 1px; line-height: 20px;">此程式碼使用TIME函數，利用呼叫副程式的方式，來達到同步，因此省去delay，避免子程式互相延遲的問題。總共有4個子程式，分別是夜光燈、底部呼吸燈與2個音樂撥放程式。程式撰寫與測試的時間差不多2天。</span></p>
<pre style="font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; color: #000000; background-color: #eee; font-size: 12px; border: 1px dashed #999999; line-height: 14px; padding: 5px; overflow: auto; width: 100%;"><code>#include &lt;Arduino.h&gt;<br>#include &lt;SoftwareSerial.h&gt;<br>#include "Garan.h"<br>#include "Timer.h"<br><br>Timer t;<br>const int bottomSet[4]={2,4,7,12};<br>const int analogInPin = A0;  // Analog input pin that the potentiometer is attached to<br>const int analogOutPin = 11; // Analog output pin that the LED is attached to<br>int brightness[4] = {0,64,128,192};<br>int fadeAmount[4] = {5,5,5,5};<br><br>#if !defined(__MSP430_CPU__)<br>SoftwareSerial garanSerial(8, 10); // RX, TX<br>#else<br>SoftwareSerial garanSerial(P1_4, P1_5); // RX, TX<br>#endif<br>Garan player(garanSerial);<br>void setup() {<br>  pinMode(bottomSet[4],INPUT);<br>  pinMode(3, OUTPUT);<br>  pinMode(5, OUTPUT);<br>  pinMode(6, OUTPUT);<br>  pinMode(9, OUTPUT);<br>  t.every(100, music,1);<br>  t.every(100, musicSET);<br>  t.every(random(10)*random(10), ThePwm);<br>  t.every(1000, NightLed);<br>} <br>void loop() {<br>  t.update();<br>}<br>//--------------------------------------------------------------------<br>void music()<br>{<br>  player.sequencePlay(2);<br>  player.setVolume(15);<br>}<br>void musicSET()<br>{<br>  for(int i=0;i&lt;4;i++ )<br>  {<br>    if (digitalRead(bottomSet[i])==HIGH)<br>    {<br>      switch(i)<br>      {<br>        case 0:<br>          player.volumeDown();<br>        break;<br>        case 1:<br>          player.volumeUp();<br>        break;<br>        case 2:<br>          player.prev();<br>        break;<br>        case 3:<br>          player.next();<br>        break;<br>      }<br>    }<br>  }<br>}<br>void ThePwm()<br>{<br>  for (int i=0;i&lt;4;i++){<br>    switch (i)<br>    {<br>      case 0:<br>        analogWrite(3, brightness[0]);<br>      break;<br>      case 1:<br>        analogWrite(5, brightness[1]);<br>      break;<br>      case 2:<br>        analogWrite(6, brightness[2]);<br>      break;<br>      case 3:<br>        analogWrite(9, brightness[3]);<br>      break;<br>    }<br>    brightness[i] = brightness[i] + fadeAmount[i];<br>    if (brightness[i] &lt;= 0 || brightness[i] &gt;= 255) {<br>      fadeAmount[i] = -fadeAmount[i] ; <br>    }    <br>  }<br>}<br><br>void NightLed()<br>{<br>  int sensorValue = analogRead(analogInPin);          <br>  if (sensorValue &gt;=1000 ){<br>    analogWrite(analogOutPin,255); <br>  }<br>  else {digitalWrite(analogOutPin,LOW); }<br>}<br><br></code></pre>
</div>
